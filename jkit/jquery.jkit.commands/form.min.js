
// jQuery Plugin: jKit
// A very easy to use, cross platform jQuery UI toolkit that's still small in size, has the features you need and doesn't get in your way.
// Version 1.2.16 - 10. May. 2013
// http://jquery-jkit.com/
//
// by Fredi Bach
// http://fredibach.ch/jquery-plugins/

plugin.commands.form=function(){var a={};return plugin.addCommandDefaults("form",{validateonly:"no"}),a.execute=function(a,b){var c=plugin.settings;a.append('<input type="hidden" name="'+c.prefix+'-requireds" id="'+c.prefix+'-requireds">'),void 0!=b.error&&(b.formerror=b.error);var d=[];a.on("submit",function(){var e=[];if($(this).find("span."+c.errorClass).remove(),$(this).find("*[rel^=jKit], *["+c.dataAttribute+"]").each(function(){var a=$(this).attr("rel"),b=$(this).attr(c.dataAttribute);if(void 0!=b)var f=b.indexOf("["),g=b.indexOf("]"),h=b.substring(f+1,g);else var f=a.indexOf("["),g=a.indexOf("]"),h=a.substring(f+1,g);var i=plugin.parseOptions(h);i.type;var k=!1,l=!1;if(void 0==i.required&&(i.required=!1),"true"==i.required&&(""==$(this).val()&&(k=!0,e.push({element:$(this),error:"required"})),l=!0,-1==$.inArray($(this).attr("name"),d)&&d.push($(this).attr("name"))),l||""!=$(this).val()||"group"==i.type){if("email"!=i.type||$.fn.jKit_emailCheck($(this).val())||(k=!0,e.push({element:$(this),error:"email"})),"url"!=i.type||$.fn.jKit_urlCheck($(this).val())||(k=!0,e.push({element:$(this),error:"url"})),"date"!=i.type||$.fn.jKit_dateCheck($(this).val())||(k=!0,e.push({element:$(this),error:"date"})),"date"==i.type&&new Date($(this).val()).getTime()<=new Date($(i.older).val()).getTime()&&(k=!0,e.push({element:$(this),error:"older"})),"date"==i.type&&new Date($(this).val()).getTime()>=new Date($(i.younger).val()).getTime()&&(k=!0,e.push({element:$(this),error:"younger"})),"time"!=i.type||$.fn.jKit_timeCheck($(this).val())||(k=!0,e.push({element:$(this),error:"time"})),"phone"!=i.type||$.fn.jKit_phoneCheck($(this).val())||(k=!0,e.push({element:$(this),error:"phone"})),"float"==i.type&&isNaN($(this).val())&&(k=!0,e.push({element:$(this),error:"float"})),"int"==i.type&&parseInt($(this).val())!=$(this).val()&&(k=!0,e.push({element:$(this),error:"int"})),("int"==i.type||"float"==i.type)&&void 0!=i.min&&$(this).val()<i.min&&"group"!=i.type&&(k=!0,e.push({element:$(this),error:"min"})),("int"==i.type||"float"==i.type)&&void 0!=i.max&&$(this).val()>i.max&&"group"!=i.type&&(k=!0,e.push({element:$(this),error:"max"})),("int"==i.type||"float"==i.type)&&void 0!=i.bigger&&$(this).val()>$(i.bigger).val()&&(k=!0,e.push({element:$(this),error:"bigger"})),("int"==i.type||"float"==i.type)&&void 0!=i.smaller&&$(this).val()<$(i.smaller).val()&&(k=!0,e.push({element:$(this),error:"smaller"})),"int"!=i.type&&"float"!=i.type&&void 0!=i.min&&$(this).val().length<i.min&&"group"!=i.type&&(k=!0,e.push({element:$(this),error:"minlength"})),"int"!=i.type&&"float"!=i.type&&void 0!=i.max&&$(this).val().length>i.max&&"group"!=i.type&&(k=!0,e.push({element:$(this),error:"maxlength"})),void 0!=i.length&&$(this).val().length!=i.length&&(k=!0,e.push({element:$(this),error:"length"})),"int"!=i.type&&"float"!=i.type&&void 0!=i.longer&&$(this).val().length>$(i.longer).val().length&&(k=!0,e.push({element:$(this),error:"longer"})),"int"!=i.type&&"float"!=i.type&&void 0!=i.shorter&&$(this).val().length<$(i.shorter).val().length&&(k=!0,e.push({element:$(this),error:"shorter"})),void 0!=i.strength&&$.fn.jKit_passwordStrength($(this).val())<i.strength&&(k=!0,e.push({element:$(this),error:"strength"})),void 0!=i.same&&$(this).val()!=$(i.same).val()&&(k=!0,e.push({element:$(this),error:"same"})),void 0!=i.different&&$(this).val()!=$(i.different).val()&&(k=!0,e.push({element:$(this),error:"different"})),"extension"==i.type){var m=i.options.split(c.delimiter),n=$(this).val().split("."),o=n[n.length-1];-1==$.inArray(o,m)&&(k=!0,e.push({element:$(this),error:"ext"}))}if("group"==i.type)if(void 0!=i.min||void 0!=i.max){var p=0;$(this).children("input[type=checkbox][checked]").each(function(){p++}),(void 0!=i.min&&i.min>p||void 0!=i.max&&p>i.max)&&(k=!0,e.push({element:$(this),error:"group"}))}else void 0==$(this).find("input[name='"+i.name+"']:checked").val()&&(k=!0,e.push({element:$(this),error:"group"}));if("custom"==i.type&&void 0!=i.checkfunction){var q=window[i.checkfunction];"function"==typeof q&&(q($(this).val())||(k=!0,e.push({element:$(this),error:"custom"})))}}k?(void 0!=i.error&&$(this).after('<span class="'+c.errorClass+'">'+i.error+"</span>"),$(this).addClass(c.errorClass)):$(this).removeClass(c.errorClass)}),0==e.length){if("yes"==b.validateonly)return plugin.triggerEvent("complete",a,b),!0;var f=$(this).attr("action");return a.removeClass(c.errorClass),void 0==b.success&&(b.success="Your form has been sent."),a.find("input#"+c.prefix+"-requireds").val(d.join(c.delimiter)),$.post(f,a.serialize(),function(d){if(a.find("."+c.errorClass).hide(),void 0!=d.sent&&1==d.sent)"#"==b.success.charAt(0)?a.html($(b.success).show()):a.html('<p class="'+c.successClass+'">'+b.success+"</p>"),plugin.triggerEvent("complete",a,b),void 0!=b.macro&&plugin.applyMacro(a,b.macro);else{for(x in d.error){var g=d.error[x];a.find("*[name="+g+"]").addClass(c.errorClass).after('<span class="'+c.errorClass+'">'+b.error+"</span>")}plugin.triggerEvent("error",a,b)}}).error(function(b,d,e){alert(e),a.append('<span class="'+c.errorClass+'">There was an error submitting the form: Error Code '+b.status+"</span>")}),!1}return a.addClass(c.errorClass),void 0!=b.formerror&&a.append('<span class="'+c.errorClass+'">'+b.formerror+"</span>"),plugin.triggerEvent("error",a,b),!1})},a}();
